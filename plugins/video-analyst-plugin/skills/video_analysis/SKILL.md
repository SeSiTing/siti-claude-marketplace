---
name: video_analysis
description: 视频处理和分析工具，使用 ffmpeg 将视频切片为图片，然后分析图片内容。
---

# 视频处理和分析工具

## 【核心功能】

使用 ffmpeg 将视频文件切片为图片帧，然后对图片进行分析，提取视频中的关键信息。

## 【工作流程】

1. **环境检查**：检查 ffmpeg 是否可用
2. **策略制定**：根据视频时长制定抽帧策略
3. **视频切片**：使用 ffmpeg 将视频提取为图片帧
4. **图片分析**：对提取的图片进行内容分析
5. **结果汇总**：整合成完整的视频分析报告

## 【FFmpeg 操作指南】

### 1. 抽帧策略（Frame Extraction Strategy）

根据视频时长选择合适的抽帧频率，以平衡分析精度和效率：

| 视频时长 | 推荐策略 | ffmpeg 参数 | 预期产出 |
| :--- | :--- | :--- | :--- |
| **< 10秒** | 高频抽帧（每秒1帧） | `-vf fps=1` | 5-10 张 |
| **10秒 - 1分钟** | 标准抽帧（每5秒1帧） | `-vf fps=1/5` | 2-12 张 |
| **1-5分钟** | 低频抽帧（每10秒1帧） | `-vf fps=1/10` | 6-30 张 |
| **> 5分钟** | 稀疏抽帧（每30秒1帧） | `-vf fps=1/30` | > 10 张 |

### 2. 标准命令格式

使用以下标准命令进行抽帧，确保命名规范：

```bash
# 创建输出目录
mkdir -p frames

# 执行抽帧 (示例：每5秒1帧)
ffmpeg -i "<输入视频路径>" -vf fps=1/5 -q:v 2 "frames/vframe_%04d.jpg"
```

**参数说明**：
- `-i`: 输入文件路径
- `-vf fps=1/5`: 过滤器，设置帧率（此处为每5秒1帧）
- `-q:v 2`: 图片质量（1-31，2为高质量且体积适中）
- `frames/vframe_%04d.jpg`: 输出路径，%04d 会自动生成 0001, 0002 等序号

### 3. 常用命令速查

```bash
# [场景A] 短视频 (<10s) -> 每秒1帧
ffmpeg -i input.mp4 -vf fps=1 -q:v 2 frames/vframe_%04d.jpg

# [场景B] 标准视频 -> 每10秒1帧
ffmpeg -i input.mp4 -vf fps=1/10 -q:v 2 frames/vframe_%04d.jpg

# [场景C] 指定时间段 -> 从第30秒开始截取10秒，每秒1帧
ffmpeg -i input.mp4 -ss 00:00:30 -t 10 -vf fps=1 -q:v 2 frames/vframe_%04d.jpg

# [场景D] 提取关键帧 (I帧) -> 快速概览
ffmpeg -i input.mp4 -vf "select='eq(pict_type,I)'" -vsync vfr frames/vframe_%04d.jpg
```

## 【图片分析指导】

### 分析模板

对每张图片（关键帧）的分析应包含以下维度：

```
【帧编号】vframe_00xx.jpg (约 00:xx 秒)
--------------------------------------------------
1. 视觉内容：[描述画面中的主要物体、人物、背景]
2. 场景环境：[描述光线、场所、氛围]
3. 关键动作：[描述发生的动作或变化]
4. 文字信息：[提取画面可见文字，如有]
--------------------------------------------------
```

### 汇总报告结构

分析完成后，生成一份结构化报告：

1. **视频概览**：时长、预估场景数、主要内容摘要
2. **时间线分析**：按时间顺序描述视频内容的演变
3. **关键要素**：识别出的人物、物体、文字清单
4. **总结建议**：基于分析结果的洞察或优化建议

## 【注意事项】

1. **路径处理**：文件名若包含空格，务必使用引号包裹，如 `"my video.mp4"`。
2. **资源管理**：生成的图片目录 `frames/` 属于临时文件，分析结束后建议询问用户是否保留。
3. **工具验证**：执行任务前，先运行 `ffmpeg -version` 确认工具可用。
